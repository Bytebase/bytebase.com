---
title: The Database CI/CD Best Practice with Azure DevOps
author: Ningjing
updated_at: 2023/10/24 14:15
feature_image: /content/docs/tutorials/database-cicd-best-practice-with-azure-devops/database-cicd-with-azure-devops.webp
tags: Tutorial
integrations: 'Azure DevOps'
level: Intermediate
estimated_time: '30 mins'
description: We already have CI/CD for code delivery, why not the database? Imagine applying and deploying database changes the same way you would application code.
---

_Wanna other VCS providers instead?_ ðŸ‘‰

- [The Database CI/CD Best Practice with GitLab](/docs/tutorials/database-cicd-best-practice-with-gitlab)
- [The Database CI/CD Best Practice with GitHub](/docs/tutorials/database-cicd-best-practice-with-github)
- [The Database CI/CD Best Practice with Bitbucket](/docs/tutorials/database-cicd-best-practice-with-bitbucket)

## The Database CI/CD Workflow

<IncludeBlock url="/docs/tutorials/share/database-workflow"></IncludeBlock>

## Set Up Database CI/CD with Azure DevOps in Bytebase (Free Plan)

Here's a step-by-step tutorial on how to set up this Database CI/CD with Azure DevOps in Bytebase.

## Step 1 - Run Bytebase in Docker and set the External URL generated by ngrok

<IncludeBlock url="/docs/get-started/install/vcs-with-ngrok"></IncludeBlock>

## Step 2 - Add Azure DevOps as a Git provider in Bytebase

1. Visit Bytebase via your ngrok URL. Click **gear icon** (Settings) > **Integration** > **GitOps**, choose `Azure DevOps Service`, and click **Next**.
   ![bb-git-provider](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/bb-git-provider.webp)

2. You will see STEP 2. Copy the **Redirect URI**. Click `Direct Link` to your Azure DevOps account.
   ![bb-gitops-step2](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/bb-gitops-step2.webp)

3. On the Azure DevOps application registration page, fill the form as follows:

   - **Company name**: can be other names than `bb`, as long as the organization admin can identify this application is for Bytebase later
   - **Homepage URL**: can be other URLs than `https://bytebase.com`
   - **Authorization callback URL**: **Redirect URI** copied from Bytebase STEP 2, begins with the host:port where the Bytebase console is running, and followed by /oauth/callback. This is the URI Azure DevOps uses to callback Bytebase during the OAuth flow
   - **Authorizied scopes**: Find the checkboxes for `Code (full)`, `Identity (read)`, `Project and team (read)`, `Build (read and execute)`

   Click **Register application**.

   ![az-register-application](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/az-register-application.webp)

4. Click **show**. Copy the **App ID** and **Client Secret** and paste them into the Bytebase GitOps config page. Click **Next**. Click **Authorize** on popup. You will be redirected to the confirmation page. Click **Confirm and add**, and the Git provider is successfully added.

   ![az-confirm](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/az-confirm.webp)

   ![bb-gitops-added](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/bb-gitops-added.webp)

## Step 3 - Configure a GitOps Workflow in Bytebase

1. Go to Azure DevOps and create a new project `bytebase-gitops`. Click **Create project**.

2. Go to Bytebase, go to the `Sample Project`. Click **GitOps** tab and choose `GitOps workflow`. Click **Configure GitOps**.

3. Choose `Azure DevOps` (the git provider you just configured) and the repository you just created. You'll be redirected to STEP 3. Keep everything as default, scroll down to the bottom and check `Enable SQL Review CI via Azure DevOps Pipeline`. Click **Finish**.

   ![bb-sql-review-ci-setup](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/bb-sql-review-ci-setup.webp)

4. After SQL Review CI is automatically setup, click **Review the pull request**. You'll be redirected to Azure DevOps. Click **Complete** and you'll see the CI is automatically configured. It will be triggered later once a new pull request is created.

   ![az-sql-ci-installed](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/az-sql-ci-installed.webp)

5. Go back to Bytebase, you'll see the GitOps workflow is configured successfully.

## Step 4 - Create a Pull Request and Trigger SQL Review CI

1. Go to **Environments**, you'll see there's a SQL Review policy attached with `Prod`. Click **Edit**, you'll see three activated SQL Review rules which will be applied via CI. Let's adjust this rule to `Error` and try to break.

   ![bb-sql-review-rule-not-null-error](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/bb-sql-review-rule-not-null-error.webp)

2. To test SQL Review CI, we'll create a pull request to change the `Prod` database schema. However, it will voliate the SQL Review policy first. Go to `bytebase-gitlabcom-demo` on Azure DevOps. Click **New branch**, name it `add-nickname-table-employee`. Click **Create branch**.
3. On the new branch, create a subdirectory `bytebase`, and create a sub-subdirectory `prod`. Within the `prod` directory, create a file `employee##202310201700##ddl##add_nickname_table_employee.sql`. Copy the following SQL script into the file and commit the change.
   ```sql
   ALTER TABLE "public"."employee"
   ADD COLUMN "nick_name" text;
   ```
4. Create a pull request including the above commits. The SQL Review CI will run automatically and show the fail message. Click **Tests** to dig deeper.

   ![az-ci-fail](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/az-ci-fail.webp)

   ![az-ci-fail-test-detail](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/az-ci-fail-test-detail.webp)

5. Update the SQL script and commit in the current branch. The SQL Review CI will run again and show the pass message. Click **Complete** and **Complete Merge**.

   ```sql
   ALTER TABLE "public"."employee"
   ADD COLUMN "nick_name" text NOT NULL DEFAULT '';
   ```

   ![az-ci-pass](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/az-ci-pass.webp)

6. Go back to project `Sample Project` in Bytebase, you'll see there's an issue created by a push event.

   ![bb-push-event-notification](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/bb-push-event-notification.webp)

   ![bb-project-activity-push-event](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/bb-project-activity-push-event.webp)

7. Click to go to the issue. Because there is no approval flow or manual rollout configured. The issue rollouts automatically. You may click **View change** to see the diff.

   ![bb-issue-done](/content/docs/tutorials/database-cicd-best-practice-with-azure-devops/bb-issue-done.webp)

## Advanced Features (Enterprise Plan)

<IncludeBlock url="/docs/tutorials/share/database-workflow-advanced-features"></IncludeBlock>

## Summary

Now with Bytebase, you have a complete Database CI/CD workflow with Azure DevOps. You can apply this workflow to your own project and customize it to fit your needs. If you have any questions, please feel free join and discuss in [Discord](https://discord.gg/huyw7gRsyA).

## Further Readings

- [How to integrate SQL Review into Your GitLab or GitHub CI/CD](/docs/tutorials/how-to-integrate-sql-review-into-gitlab-github-ci/)
- [The Database CI/CD Best Practice with GitLab](/docs/tutorials/database-cicd-best-practice-with-gitlab)
- [The Database CI/CD Best Practice with GitHub](/docs/tutorials/database-cicd-best-practice-with-github)
- [The Database CI/CD Best Practice with Bitbucket](/docs/tutorials/database-cicd-best-practice-with-bitbucket)
- [Database as Code - the Good, the Bad and the Ugly](/blog/database-as-code)
